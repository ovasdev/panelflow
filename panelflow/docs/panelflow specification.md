## 1. Философия и видение

**PanelFlow** — это современный Python-фреймворк, созданный для разработки сложных, многопанельных приложений, управляемых состоянием. Его главная цель — дать разработчику возможность сосредоточиться на бизнес-логике, в то время как библиотека берет на себя всю рутину по управлению интерфейсом, навигацией и данными.

**Ключевая философия** строится на двух принципах:

1. **Строгое разделение ответственности**: _Что_ представляет собой приложение (его структура, панели, виджеты) отделено от того, _как_ оно работает (бизнес-логика, обработка данных).
    
2. **Независимость от платформы**: Логика приложения пишется один раз и может быть отображена в любой среде — в терминале (TUI), в вебе или в виде десктопного приложения — простым подключением соответствующего "движка" рендеринга.
    

## 2. Трехуровневая архитектура

В основе PanelFlow лежит четкая архитектура из трех независимых слоев, что обеспечивает максимальную гибкость, тестируемость и расширяемость.

```
graph TD
    subgraph "Слой Приложения (Ваш код)"
        A[main.py] --> B["application.json (Структура)"];
        A --> C["handlers.py (Логика)"];
    end

    subgraph "Слой Ядра (panelflow.core)"
        CoreApp[Мозг приложения]
        Abstracts[Абстрактные компоненты]
        Events[Система событий]
        HandlersBase[Базовые обработчики]
    end

    subgraph "Слой Рендеринга (UI)"
        TUI[TUI (Textual)]
        WEB[Web (FastAPI)]
        Desktop[Desktop (PyQt)]
    end

    A -- "1. Создаёт и настраивает" --> CoreApp;
    CoreApp -- "Загружает" --> B;
    CoreApp -- "Связывает с" --> C;
    A -- "2. Выбирает и запускает с" --> TUI;
    
    CoreApp -- "Общается через" --> Events;
    TUI -- "Общается через" --> Events;
```

- **Слой Ядра (`panelflow.core`)**: Мозг вашего приложения. Он управляет состоянием, данными и навигацией, но ничего не знает о кнопках, цветах или окнах.
    
- **Слой Рендеринга** (например, `panelflow.tui`): Визуальное представление. Его задача — "рисовать" то, что говорит ему Ядро, и сообщать Ядру о действиях пользователя.
    
- **Слой Приложения**: Это ваш код, который связывает Ядро с выбранным Рендерером и определяет уникальную логику вашего продукта.
    

## 3. Ключевые концепции

### 3.1. Модель интерфейса: колонки и стеки

Интерфейс PanelFlow — это гибрид колонок Миллера и стековых панелей, что позволяет создавать сложные, но интуитивно понятные рабочие процессы.

- **Горизонтальные колонки**: Экран разделен на три вертикальные колонки, которые показывают последовательность навигации (`Шаг 1 → Шаг 2 → Шаг 3`).
    
- **Вертикальные стеки**: Внутри каждой колонки панели могут быть организованы в стек (картотеку). Это позволяет из одной точки родительской панели переходить в несколько параллельных, но взаимозаменяемых дочерних веток. Видна всегда только верхняя панель стека, но под ней и над ней могут быть видны "края" других панелей в стопке.
    

### 3.2. Модель навигации: двумерное дерево

Навигация — это больше, чем простое дерево. Это **дерево, у узлов которого есть именованные стеки дочерних веток**.

- **`TreeNode`**: Каждый узел в дереве — это экземпляр панели со своим состоянием.
    
- **`children_stacks`**: У каждого узла есть словарь, где ключ — это ID виджета-инициатора, а значение — это стек дочерних панелей, порожденных этим виджетом.
    
- **Два измерения навигации**:
    
    - **Горизонтальная (`Ctrl` + `←`/`→`)**: Перемещение фокуса между колонками.
        
    - **Вертикальная (`Ctrl` + `↑`/`↓`)**: Перемещение по стеку панелей внутри одной колонки.
        

### 3.3. Модель конфигурации: гибридный подход

- **Декларативный (`application.json`)**: Рекомендуемый способ определения базовой структуры приложения. Это делает архитектуру наглядной и легко поддерживаемой.
    
- **Императивный (API в Python)**: Для сложных, динамически генерируемых интерфейсов библиотека предоставляет методы для создания и модификации панелей и виджетов прямо из кода.
    

## 4. Опыт разработчика

Процесс создания приложения на PanelFlow состоит из трех простых шагов:

1. **Описать структуру**: Создать файл `application.json`, где определены все панели и виджеты.
    
2. **Реализовать логику**: Написать классы-обработчики, унаследованные от `BasePanelHandler`, которые описывают реакцию на действия пользователя.
    
3. **Запустить приложение**: Создать точку входа `main.py`, где инициализируется Ядро, передается ему конфигурация и обработчики, и все это запускается с выбранным Рендерером.
    

## 5. Надежность и отказоустойчивость

Библиотека спроектирована с учетом возможных ошибок. Любое исключение — будь то опечатка в `application.json` или ошибка в пользовательском коде обработчика — будет перехвачено. Приложение не "упадет", а вместо этого отобразит специальную информативную панель с описанием ошибки, что значительно упрощает отладку.