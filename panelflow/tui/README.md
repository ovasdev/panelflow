# PanelFlow TUI - Терминальный рендерер

Слой рендеринга для создания богатых терминальных интерфейсов на базе библиотеки [Textual](https://textual.textualize.io/).

## Возможности

- **Колоночная навигация** - интерфейс с тремя колонками для отображения иерархии панелей
- **Стековая навигация** - возможность организации панелей в стеки внутри колонок
- **Полное управление с клавиатуры** - все функции доступны без мыши
- **Интерактивные виджеты** - поддержка кнопок, полей ввода, списков выбора и ссылок
- **Красивые темы** - современный дизайн с поддержкой цветовых схем
- **Отзывчивый интерфейс** - адаптивная верстка под размер терминала

## Быстрый старт

```python
from panelflow.core import Application as CoreApplication
from panelflow.tui import TuiApplication

# Создание ядра с конфигурацией
core_app = CoreApplication("application.json", handler_map)

# Создание TUI-приложения  
tui_app = TuiApplication(core_app)

# Запуск
tui_app.run()
```

## Горячие клавиши

### Навигация между панелями
- `Ctrl+H` / `Ctrl+L` - переключение между колонками (влево/вправо)
- `Ctrl+J` / `Ctrl+K` - навигация по стеку панелей (вниз/вверх) 
- `←` / `Backspace` - возврат к родительской панели

### Навигация по виджетам
- `Tab` / `Shift+Tab` - переключение между виджетами в активной панели
- `Enter` - активация виджета (подтверждение, нажатие кнопки)
- `↑` / `↓` - навигация внутри списков выбора

### Управление приложением
- `Ctrl+C` - выход из приложения

## Поддерживаемые виджеты

### TuiButton
Интерактивная кнопка с текстовой подписью.

```json
{
  "id": "my_button",
  "type": "button", 
  "title": "Нажми меня",
  "value": "button_value"
}
```

### TuiTextInput  
Поле для ввода текста с заголовком и placeholder'ом.

```json
{
  "id": "name_input",
  "type": "text_input",
  "title": "Ваше имя",
  "placeholder": "Введите имя...",
  "value": ""
}
```

### TuiOptionSelect
Список опций для выбора одного значения.

```json
{
  "id": "theme_select",
  "type": "option_select", 
  "title": "Выберите тему",
  "options": ["Светлая", "Темная", "Авто"],
  "value": "Темная"
}
```

### TuiPanelLink
Ссылка для навигации к другой панели.

```json
{
  "id": "settings_link",
  "type": "panel_link",
  "title": "Настройки",
  "description": "Конфигурация приложения", 
  "target_panel_id": "settings_panel"
}
```

## Архитектура

TUI-рендерер построен по принципу строгого разделения ответственности:

- **TuiApplication** - основное приложение, связывающее Textual с ядром
- **MainScreen** - главный экран с системой колонок и обработкой навигации  
- **PanelWidget** - виджет-контейнер для отображения одной панели
- **Конкретные виджеты** - TuiButton, TuiTextInput и другие

### Поток событий

1. **Пользователь** выполняет действие (нажимает клавишу, кликает мышью)
2. **Textual** генерирует низкоуровневое событие
3. **TUI-виджет** перехватывает событие и преобразует в событие PanelFlow
4. **Событие** отправляется в ядро через `core.post_event()`
5. **Ядро** обрабатывает событие и обновляет состояние
6. **StateChangedEvent** отправляется обратно в TUI
7. **TUI** перерисовывает интерфейс согласно новому состоянию

## Кастомизация

### Темы и стили
Все стили определены в CSS-подобном синтаксисе Textual внутри соответствующих виджетов. Можно переопределить стили, унаследовавшись от существующих классов.

### Новые типы виджетов
Для добавления поддержки новых типов виджетов:

1. Создайте новый класс, наследующийся от `BaseWidgetMixin` и виджета Textual
2. Добавьте соответствие в фабричную функцию `create_widget()`
3. Определите CSS-стили и обработчики событий

### Альтернативные экраны
Можно создать альтернативные экраны для специальных случаев (помощь, настройки и т.д.), унаследовавшись от `Screen` и подключив их к `TuiApplication`.

## Требования

- Python 3.8+
- textual >= 0.40.0
- panelflow.core

## Производительность

TUI-рендерер оптимизирован для плавной работы даже с большими деревьями панелей:

- Ленивая загрузка виджетов
- Эффективная очистка и обновление колонок
- Минимальные перерисовки при навигации

## Отладка

Для отладки TUI-приложений используйте встроенные возможности Textual:

```python
# Запуск с консолью разработчика
tui_app.run(dev=True)
```

Это откроет дополнительную панель с логами и инструментами разработчика.